(function(b){FormhybridPlugins={init:function(c){this.scrollToMessages()},scrollToMessages:function(e){if(typeof e==="undefined"){e=b(".formhybrid:first")}var d=e.find(".alert:first, .error:first");if(d.length>0&&!e.hasClass("noscroll")){var c=d.offset();b("html,body").animate({scrollTop:(parseInt(c.top)-30)+"px"},500)}}};FormhybridAjaxRequest={registerEvents:function(){this.asyncSubmit()},asyncSubmit:function(d){if(typeof d!=="undefined"){var c=b(d);if(c.length>0){FormhybridAjaxRequest._asyncFormSubmit(c)}return false}b("body").on("submit",".formhybrid form[data-async]",function(g){var f=b(this);g.preventDefault();FormhybridAjaxRequest._asyncFormSubmit(f)})},_asyncFormSubmit:function(c,d,g){var e=c.serializeArray();e.push({name:"FORM_SUBMIT",value:c.attr("id")});if(typeof g!="undefined"){e.push(g)}function f(i,h){if(typeof i.result.data=="undefined"){return}if(!i.result.data.closeModal){return}h.closest(".modal").modal("hide")}b.ajax({url:d?d:c.attr("action"),dataType:"json",data:e,method:c.attr("method"),error:function(h,j,i){console.log(i);if(h.status==300){location.href=h.responseJSON.result.data.url;f(h.responseJSON,c);return}},success:function(j,l,k){if(typeof j=="undefined"){return}if(j.result.html&&j.result.data.id){var i="<div>"+j.result.html+"</div>",h=b(i).find("#"+j.result.data.id);if(typeof h!=="undefined"){c.replaceWith(h)}FormhybridPlugins.scrollToMessages(b(j.result.html));f(j,c)}}})},toggleSubpalette:function(e,d,g,c){e.blur();var j=b(e),i=b("#"+d),k=j.closest("form"),h=true;var f=k.serializeArray();f.push({name:"FORM_SUBMIT",value:k.attr("id")},{name:"subId",value:d},{name:"subField",value:g});if(j.is(":checkbox")||j.is(":radio")){h=j.is(":checked")}if(h===false){b.ajax({type:"post",url:c,dataType:"json",data:f,success:function(l){i.remove()}});return}f.push({name:"subLoad",value:1});b.ajax({type:"post",url:c,dataType:"json",data:f,success:function(l,n,m){i.remove();if(j.closest("form").find("."+g).length>0){j.closest("form").find("."+g).eq(0).after(l.result.html)}else{j.closest("#ctrl_"+g).after(l.result.html)}}})},reload:function(e,d){var c=b("#"+e);this._asyncFormSubmit(c,d)},};var a={getParameterByName:function(c,d){var g=decodeURIComponent(d),f=g.split("&"),h,e;for(e=0;e<f.length;e++){h=f[e].split("=");if(h[0]===c){return h[1]===undefined?true:h[1]}}}};b(document).ready(function(){FormhybridAjaxRequest.registerEvents();FormhybridPlugins.init()});b(document).ajaxComplete(function(e,d,c){FormhybridPlugins.init(a.getParameterByName("action",c.data))})})(jQuery);