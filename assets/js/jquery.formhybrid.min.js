(function(b){FormhybridPlugins={init:function(c){this.scrollToMessages()},scrollToMessages:function(d){if(typeof d==="undefined"){d=b(".formhybrid:first")}var c=d.find(".alert:first, .error:first");if(c.length>0&&!d.hasClass("noscroll")){HASTE_PLUS.scrollTo(c,100,500)}}};FormhybridAjaxRequest={registerEvents:function(){this.asyncSubmit()},asyncSubmit:function(d){if(typeof d!=="undefined"){var c=b(d);if(c.length>0){FormhybridAjaxRequest._asyncFormSubmit(c)}return false}b(document).on("submit",".formhybrid form[data-async]",function(g){var f=b(this);g.preventDefault();FormhybridAjaxRequest._asyncFormSubmit(f)})},_asyncFormSubmit:function(d,e,i){var f=d.serializeArray();f.push({name:"FORM_SUBMIT",value:d.attr("id")});var j=d.find(":input[type=submit]");d.find(":input:not([disabled])").prop("disabled",true);if(typeof i!="undefined"){f.push(i)}function g(l,k){if(typeof l.result.data=="undefined"){return}if(!l.result.data.closeModal){return}k.closest(".modal").modal("hide")}var c=j;if(j.is("button")){if(j.children().length>0){var h=j.find(":not(.before, .after)");if(h.length>0){c=h.first()}}}b.ajax({url:e?e:d.attr("action"),dataType:"json",data:f,method:d.attr("method"),beforeSend:function(){var k=0,l=c.text();setInterval(function(){c.text(l+Array((++k%4)+1).join("."))},500)},error:function(l,n,m){if(l.status==300){var k=l.responseJSON.result.data.url;location.href=k.charAt(0)=="/"?k:"/"+k;g(l.responseJSON,d);return}},success:function(m,o,n){if(typeof m=="undefined"){return}if(m.result.html&&m.result.data.id){var l="<div>"+m.result.html+"</div>",k=b(l).find("#"+m.result.data.id);if(typeof k!=="undefined"){d.replaceWith(k)}FormhybridPlugins.scrollToMessages(k);g(m,d)}}})},toggleSubpalette:function(e,d,g,c){e.blur();var k=b(e),j=k.attr("id"),i=b("#"+d),l=k.closest("form"),h=true,f=l.serializeArray();k.attr("disabled",true);f.push({name:"FORM_SUBMIT",value:l.attr("id")},{name:"subId",value:d},{name:"subField",value:g});if(k.is(":checkbox")||k.is(":radio")){h=k.is(":checked")}if(h===false){b.ajax({type:"post",url:c,dataType:"json",data:f,success:function(m){i.remove();k.closest("form").find("#"+j).attr("disabled",false)}});return}f.push({name:"subLoad",value:1});b.ajax({type:"post",url:c,dataType:"json",data:f,success:function(m,o,n){i.remove();if(k.closest("form").find("."+g).length>0){k.closest("form").find("."+g).eq(0).after(m.result.html)}else{k.closest("#ctrl_"+g).after(m.result.html)}k.closest("form").find("#"+j).attr("disabled",false)}})},reload:function(e,d){var c=b("#"+e);this._asyncFormSubmit(c,d)}};var a={getParameterByName:function(c,d){var g=decodeURIComponent(d),f=g.split("&"),h,e;for(e=0;e<f.length;e++){h=f[e].split("=");if(h[0]===c){return h[1]===undefined?true:h[1]}}}};b(document).ready(function(){FormhybridAjaxRequest.registerEvents();FormhybridPlugins.init()});b(document).ajaxComplete(function(e,d,c){if(typeof c=="undefined"){return false}FormhybridPlugins.init(a.getParameterByName("action",c.data))})})(jQuery);